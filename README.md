# Practice-lightIT

# Інструкція для запуску і тестування коду
1. **main.py** - головний файл зі всією системою REST API. Може бути протестований за допомогою файлу `Testing.postman_collection.json` (Запустити `main.py`, імпортувати JSON файл в Postman і потім запустити тестування).
2. **main_test.py** - файл для тестування маршрутів і логіки проекту за допомогою pytest.

# Документація з ендпоінтами
## Головна сторінка

### `GET /`
- **Опис:** Повертає ID поточного користувача або повідомлення про успішний вихід.
- **Відповідь:**
  - **200 OK:** 
    - Якщо увійшов: `Logged in as: <current_user.id>`
    - Якщо вийшов: `{ "Logout": "Success" }`

## Маршрути для продуктів

### `GET /products`
- **Опис:** Отримує всі продукти.
- **Відповідь:**
  - **200 OK:** 
    - Якщо увійшов як `seller`, `cashier` або `accountant`: Повертає всі продукти.
    - Якщо не увійшов або увійшов з іншою роллю: Повертає продукти зі статусом, відмінним від 'Ordered'.
  - **Приклад відповіді:**
    ```json
    [
      {
        "id": 1,
        "name": "Продукт 1",
        "price": 100.0,
        "date": "2024-06-14T00:00:00",
        "status": "Available"
      },
      {
        "id": 2,
        "name": "Продукт 2",
        "price": 150.0,
        "date": "2024-06-15T00:00:00",
        "status": "Ordered"
      }
    ]
    ```

### `POST /products`
- **Опис:** Додає один або кілька продуктів до бази даних.
- **Тіло запиту:**
  - Один продукт:
    ```json
    {
      "name": "Назва продукту",
      "price": 100.0,
      "date": "2024-06-14T00:00:00",
      "status": "Available"
    }
    ```
  - Кілька продуктів:
    ```json
    [
      {
        "name": "Продукт 1",
        "price": 100.0,
        "date": "2024-06-14T00:00:00",
        "status": "Available"
      },
      {
        "name": "Продукт 2",
        "price": 150.0,
        "date": "2024-06-15T00:00:00",
        "status": "Ordered"
      }
    ]
    ```
- **Відповідь:**
  - **201 Created:** Повертає додані продукти.
  - **Приклад відповіді:**
    ```json
    [
      {
        "id": 1,
        "name": "Продукт 1",
        "price": 100.0,
        "date": "2024-06-14T00:00:00",
        "status": "Available"
      },
      {
        "id": 2,
        "name": "Продукт 2",
        "price": 150.0,
        "date": "2024-06-15T00:00:00",
        "status": "Ordered"
      }
    ]
    ```
### `PUT /products/<int:product_id>`

- **Опис:** Оновлює продукт з вказаним ID.
- **Тіло запиту:**
  - Приклад:
    ```json
    {
      "name": "Оновлена назва продукту",
      "price": 120.0,
      "date": "2024-07-01T00:00:00"
    }
    ```
- **Відповідь:**
  - **200 OK:** Повертає оновлений продукт.
  - **404 Not Found:** Якщо продукт з вказаним ID не існує.
  - **Приклад відповіді:**
    ```json
    {
      "id": 1,
      "name": "Оновлена назва продукту",
      "price": 120.0,
      "date": "2024-07-01T00:00:00"
    }
    ```

### `PATCH /products/<int:product_id>`

- **Опис:** Частково оновлює продукт з вказаним ID.
- **Тіло запиту:**
  - Приклад:
    ```json
    {
      "name": "Оновлена назва продукту",
      "price": 130.0
    }
    ```
- **Відповідь:**
  - **200 OK:** Повертає оновлений продукт.
  - **404 Not Found:** Якщо продукт з вказаним ID не існує.
  - **Приклад відповіді:**
    ```json
    {
      "id": 1,
      "name": "Оновлена назва продукту",
      "price": 130.0,
      "date": "2024-07-01T00:00:00"
    }
    ```

### `DELETE /products/<int:product_id>`

- **Опис:** Видаляє продукт з вказаним ID.
- **Відповідь:**
  - **200 OK:** Якщо продукт був успішно видалений.
  - **404 Not Found:** Якщо продукт з вказаним ID не існує.
  - **Приклад відповіді:**
    ```json
    {
      "Success": "Product deleted"
    }
    ```

### `POST /orders`

- **Опис:** Створює замовлення на продукт.
- **Тіло запиту:**
  - Приклад:
    ```json
    {
      "product_id": 1
    }
    ```
- **Відповідь:**
  - **201 Created:** Повертає створене замовлення.
  - **404 Not Found:** Якщо продукт з вказаним ID не існує.
  - **Приклад відповіді:**
    ```json
    {
      "order_id": 1,
      "product_id": 1,
      "price": 80.0,
      "date": "2024-06-21T00:00:00",
      "status": "Just Created",
      "discount": "With discount"
    }
    ```
### `GET /orders`
- **Опис:** Отримує всі замовлення.
- **Відповідь:**
  - **200 OK:** Повертає список замовлень.
  - **Приклад відповіді:**
    ```json
    [
      {
        "order_id": 1,
        "product_id": 1,
        "price": 100.0,
        "date": "2024-06-14T00:00:00",
        "status": "Just Created",
        "discount": "Without discount"
      },
      {
        "order_id": 2,
        "product_id": 2,
        "price": 150.0,
        "date": "2024-06-15T00:00:00",
        "status": "Just Created",
        "discount": "Without discount"
      }
    ]
    ```

### `PATCH /orders/<int:order_id>`
- **Опис:** Частково оновлює замовлення з вказаним ID.
- **Тіло запиту:**
  - Приклад:
    ```json
    {
      "status": "Оновлений статус"
    }
    ```
- **Відповідь:**
  - **200 OK:** Повертає оновлене замовлення.
  - **404 Not Found:** Якщо замовлення з вказаним ID не існує.
  - **Приклад відповіді:**
    ```json
    {
      "order_id": 1,
      "product_id": 1,
      "price": 100.0,
      "date": "2024-06-14T00:00:00",
      "status": "Оновлений статус"
    }
    ```

### `GET /orders/find`
- **Опис:** Шукає замовлення у вказаному діапазоні дат. Потребує дозволу бухгалтера.
- **Параметри запиту:**
  - `from_date` (обов'язково): Початкова дата для пошуку (формат ISO).
  - `to_date` (обов'язково): Кінцева дата для пошуку (формат ISO).
- **Відповідь:**
  - **200 OK:** Повертає список замовлень у вказаному діапазоні дат.
  - **400 Bad Request:** Якщо параметри дат відсутні або недійсні.
  - **403 Forbidden:** Якщо у користувача немає необхідних дозволів.
  - **Приклад відповіді:**
    ```json
    [
      {
        "order_id": 1,
        "product_id": 1,
        "price": 100.0,
        "date": "2024-06-14T00:00:00",
        "status": "Just Created"
      },
      {
        "order_id": 2,
        "product_id": 2,
        "price": 150.0,
        "date": "2024-06-15T00:00:00",
        "status": "Just Created"
      }
    ]
    ```

### `POST /orders/accept`
- **Опис:** Приймає замовлення, змінюючи його статус на "Accepted". Потребує дозволу бухгалтера.
- **Тіло запиту:**
  - Приклад:
    ```json
    {
      "order_id": 1
    }
    ```
- **Відповідь:**
  - **200 OK:** Повертає повідомлення про прийняття замовлення.
  - **404 Not Found:** Якщо замовлення з вказаним ID не існує.
  - **403 Forbidden:** Якщо у користувача немає необхідних дозволів.
  - **Приклад відповіді:**
    ```json
    {
      "message": "Order accepted",
      "order_id": 1,
      "status": "Accepted"
    }
    ```
### `POST /orders/invoice`
- **Опис:** Створює накладну для прийнятого замовлення. Потребує дозволу бухгалтера.
- **Тіло запиту:**
  - Приклад:
    ```json
    {
      "order_id": 1
    }
    ```
- **Відповідь:**
  - **201 Created:** Повертає повідомлення про створення накладної.
  - **404 Not Found:** Якщо замовлення з вказаним ID не існує.
  - **400 Bad Request:** Якщо замовлення не знаходиться в прийнятому статусі для генерації накладної.
  - **403 Forbidden:** Якщо у користувача немає необхідних дозволів.
  - **Приклад відповіді:**
    ```json
    {
      "message": "Invoice created",
      "invoice_id": 1,
      "order_id": 1,
      "status": "paid"
    }
    ```

### `GET /invoices`
- **Опис:** Отримує всі накладні. Потребує дозволу бухгалтера.
- **Відповідь:**
  - **200 OK:** Повертає список накладних.
  - **403 Forbidden:** Якщо у користувача немає необхідних дозволів.
  - **Приклад відповіді:**
    ```json
    [
      {
        "id": 1,
        "order_id": 1,
        "product_name": "Product 1",
        "product_price": 100.0,
        "order_date": "2024-06-14T00:00:00",
        "invoice_date": "2024-06-21T00:00:00"
      },
      {
        "id": 2,
        "order_id": 2,
        "product_name": "Product 2",
        "product_price": 150.0,
        "order_date": "2024-06-15T00:00:00",
        "invoice_date": "2024-06-21T00:00:00"
      }
    ]
    ```

### `DELETE /delete`
- **Опис:** Видаляє всі дані з бази даних. Потребує дозволу бухгалтера.
- **Відповідь:**
  - **200 OK:** Повертає повідомлення про успішне видалення всіх даних разом із кількістю видалених записів.
  - **500 Internal Server Error:** Якщо сталася помилка під час процесу видалення.
  - **403 Forbidden:** Якщо у користувача немає необхідних дозволів.
  - **Приклад відповіді:**
    ```json
    {
      "message": "All data deleted successfully",
      "orders_deleted": 10,
      "invoices_deleted": 5,
      "products_deleted": 15
    }
    ```

### `GET /login` і `POST /login`
- **Опис:** Обробляє вхід користувача.
- **Тіло запиту (POST):**
  - Приклад:
    ```html
    <form method="post">
        <p><input type=text name=username>
        <p><input type=password name=password>
        <p><input type=submit value=Login>
    </form>
    ```
- **Відповідь:**
  - **200 OK:** Відображає форму входу (GET).
  - **302 Found:** Перенаправляє на головну сторінку після успішного входу (POST).
  - **Приклад відповіді:**
    ```html
    <form method="post">
        <p><input type=text name=username>
        <p><input type=password name=password>
        <p><input type=submit value=Login>
    </form>
    ```

    
